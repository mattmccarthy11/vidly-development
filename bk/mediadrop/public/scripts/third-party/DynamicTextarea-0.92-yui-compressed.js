var DynamicTextarea=new Class({Implements:[Options,Events],options:{value:"",minRows:1,string:"",noBreaks:false,value:null,basic:"default",focused:"focused",filled:"filled",disabled:"disabled",timeout:"ready",maxLength:Infinity,lineHeight:null,offset:0,ctaClass:""},elements:{input:null,parent:null,cta:null},initialize:function(b,a){this.setOptions(a);this.elements.input=document.id(b);if(!this.elements.input){return}if(window.Browser.Engine.gecko){this.options.offset=parseInt(this.elements.input.getStyle("padding-top"),10)+parseInt(this.elements.input.getStyle("padding-bottom"),10)+parseInt(this.elements.input.getStyle("border-bottom-width"),10)+parseInt(this.elements.input.getStyle("border-top-width"),10);this.options.padding=0}else{this.options.offset=parseInt(this.elements.input.getStyle("border-bottom-width"),10)+parseInt(this.elements.input.getStyle("border-top-width"),10);this.options.padding=parseInt(this.elements.input.getStyle("padding-top"),10)+parseInt(this.elements.input.getStyle("padding-bottom"),10)}this.elements.parent=this.elements.input.getParent();if(this.options.string!=""&&window.OverText){this.elements.cta=new OverText(this.elements.input,{textOverride:this.options.string,labelClass:this.options.ctaClass})}var c="";if(this.elements.input.value==""){this.elements.parent.addClass(this.options.basic)}else{c=this.elements.input.value;this.elements.parent.addClass(this.options.filled)}this.elements.input.set({rows:1,styles:{resize:"none",position:"relative",display:"block",overflow:"hidden",height:"auto"}});this.elements.input.value="M";this.options.lineHeight=(this.elements.input.measure(function(){return this.getScrollSize().y}))-this.options.padding;this.elements.input.value=c;this.elements.input.setStyle("height",this.options.lineHeight*this.options.minRows);this.focus=this.focus.bind(this);this.delayStart=this.delayStart.bindWithEvent(this);this.delayStart=this.delayStart.bindWithEvent(this);this.blur=this.blur.bind(this);this.scrollFix=this.scrollFix.bind(this);this.checkSize=this.checkSize.bind(this);this.clean=this.clean.bind(this);this.disable=this.disable.bind(this);this.enable=this.enable.bind(this);this.checkSize(true);this.elements.input.addEvent("focus",this.focus);this.fireEvent("load")},scrollFix:function(){this.elements.input.scrollTo(0,0)},focus:function(){this.elements.parent.removeClass(this.options.basic);this.elements.parent.removeClass(this.options.filled);this.elements.parent.addClass(this.options.focused);this.elements.input.addEvents({keydown:this.delayStart,keypress:this.delayStart,blur:this.blur,scroll:this.scrollFix});this.fireEvent("focus")},blur:function(){this.elements.parent.removeClass(this.options.focused);if(this.elements.input.value==""){this.elements.parent.addClass(this.options.basic)}else{this.elements.parent.addClass(this.options.filled)}this.elements.input.removeEvents({keydown:this.delayStart,keypress:this.delayStart,blur:this.blur,scroll:this.scrollFix});this.fireEvent("blur")},delayStart:function(a){if(this.options.timeout=="ready"&&this.options.value.length<this.options.maxLength){this.options.timeout=setTimeout(this.checkSize,1);return}if((this.options.maxLength&&this.options.maxLength!=null&&this.options.value.length>=this.options.maxLength&&a.key!="backspace"&&a.key!="delete"&&a.meta==false&&a.control==false&&a.shift==false&&a.key!="up"&&a.key!="down"&&a.key!="left"&&a.key!="tab"&&a.key!="right")||(this.options.noBreaks==true&&(a.key=="enter"||a.key=="return"))){a.preventDefault();return}if(this.options.timeout=="ready"){this.options.timeout=setTimeout(this.checkSize,1)}},checkSize:function(e){var b=this.options.value;this.options.value=this.elements.input.value;this.options.timeout=0;if(this.options.value==b&&e!=true){this.options.timeout="ready";return}if(b==null||this.options.value.length<b.length){this.elements.parent.setStyle("height",this.elements.parent.getSize().y);this.elements.input.setStyle("height",this.options.minRows*this.options.lineHeight)}var d=this.elements.input.getScrollSize().y;var a=this.elements.input.offsetHeight;var c=d-this.options.padding;var f=d+this.options.offset;if(f!=a&&c>this.options.minRows*this.options.lineHeight){this.elements.input.setStyle("height",c)}this.elements.parent.setStyle("height","auto");this.options.timeout="ready";if(e!=true){this.fireEvent("keyPress")}},reset:function(){this.elements.input.value="";this.checkSize(true);this.elements.parent.removeClass(this.options.filled);this.elements.parent.removeClass(this.options.focused);this.elements.parent.addClass(this.options.basic);this.fireEvent("reset")},setCaret:function(b){if(!document.selection){this.elements.input.selectionStart=b;this.elements.input.selectionEnd=b}else{var a=document.selection.createRange();a.moveStart("character",-this.elements.input.value.length);a.moveStart("character",b);a.moveEnd("character",0);a.select()}},clean:function(){this.elements.input.removeEvents({focus:this.focus,keydown:this.delayStart,keypress:this.delayStart,blur:this.blur,scroll:this.scrollFix})},disable:function(){this.elements.input.blur();this.elements.input.removeEvents({focus:this.focus,keydown:this.delayStart,keypress:this.delayStart,blur:this.blur,scroll:this.scrollFix});this.elements.input.set(this.options.disabled,true);this.elements.parent.addClass(this.options.disabled);this.fireEvent("disable")},enable:function(){this.elements.input.addEvents({focus:this.focus,scroll:this.scrollFix});this.elements.input.set(this.options.disabled,false);this.elements.parent.removeClass(this.options.disabled);this.fireEvent("enable")}});